# Schema to experiment with. This is a few types from the
# Language Server Protocol as it is not entirely trivial.

Position:
  line: integer       # Zero based line
  character: integer  # Zero based column

Range:
  start: Position
  end: Position

Location:
  uri: string
  range: Range

LocationLink:
  targetUri: string
  targetRange: Range
  targetSelectionRange: Range

Diagnostic:
  range: Range
  message: string

TextDocumentIdentifier:
  uri: string

TextDocumentItem:
  <:TextDocumentIdentifier
  languageId: string
  version: integer
  text: string

TextDocumentContentChangeEvent:
  range?: Range
  text: string

# -- Initialize Request

#InitializeParams:              # We handle that as plain json

ServerInfo:
  name: string
  version: string

InitializeResult:
  capabilities: object          # Lots. We output that directly as plain json.
  serverInfo: ServerInfo

# -- Text document notifiations.
DidOpenTextDocumentParams:      # textDocument/didOpen
  textDocument: TextDocumentItem

DidChangeTextDocumentParams:    # textDocument/didChange
  textDocument: TextDocumentIdentifier
  contentChanges+: TextDocumentContentChangeEvent

DidSaveTextDocumentParams:      # textDocument/didSave
  textDocument: TextDocumentIdentifier

DidCloseTextDocumentParams:     # textDocument/didClose
  textDocument: TextDocumentIdentifier

# -- textDocument/hover
TextDocumentPositionParams:
  textDocument: TextDocumentIdentifier
  position: Position

HoverParams:
  <: TextDocumentPositionParams

MarkupContent:
  kind: string = "markdown"
  value: string

Hover:
  contents: MarkupContent
  range?: Range

# -- Code action
CodeActionParams:              # textDocument/codeAction
  #<:WorkDoneProgressParams,
  #<:PartialResultParams
  textDocument: TextDocumentIdentifier
  range: Range
  #context: CodeActionContext

CodeAction:  # Response to code action is either an array of these
  title: string
  #kind?: string   # Kind of change e.g quickfix, refactor, ...
  diagnostics+: Diagnostic
  isPreferred: boolean = false
  #edit?: WorkspaceEdit

# -- textDocument/publishDiagnostics
# This is a notification that is sent from the server to the client
PublishDiagnosticParams:
  uri: string
  diagnostics+: Diagnostic